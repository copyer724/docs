# 接口的设计规范

1.**签名**

目的：防止数据被篡改

- 接口请求方法将请求方式，时间戳和密钥拼接成一个字符串
- 使用 MD5 等 hash 算法生成签名（sign）
- 在请求参数或请求头中增加 sign 参数传给 API 接口
- API 接口王国服务验证传递的 sign 值，与自己生成的 sign 值对比，如果一样，则认为请求有效

时间戳的作用：防止同一次请求被反复利用，增加密钥被破解的可能性。每次请求设置合理的过期时间（如 15 分钟）

2. **加密**

目的：保护重要数据（密码，银行卡等）

方法：

- 使用 AES 算法对数据进行加密
- 在前端使用公钥加密用户密码
- 在注册接口中使用密钥解密用户密码并做相关验证

3. **IP 白名单**

目的：防止被恶意请求

方法：

- 限制请求 IP
- 添加 IP 白名单在 API 网关服务上。
- 防止内部服务器被攻破，需增加 web 防火墙。

4. **限流**

目的：防止 API 接口被频繁调用导致服务器压力过大，不可用

方法：

- 对请求 IP，请求接口，请求用户做限流。
- 使用 Nginx, Redis 或 Gateway 做限流。

5. **参数校验**

目的：拦截无效请求，保护系统资源

方法：

- 校验字段是否为空，字段类型，字段长度，枚举值

6. **同一返回值**

目的：避免返回值结构不统一，便于接口维护

方法：

- 所有异常通过 API 网关捕获并转化成统一的异常结构返回。

7. **同一封装异常**

目的：防止敏感信息

```ts
{
  code: 500,
  message: '服务器内部异常',
  data: null
}
```

8. **请求日志**

目的：便于快速分析和定位问题

9. **数据脱敏**

10. **接口文档**

11. **请求方式**

12. **请求头**

13. **职责单一**

目的：降低接口维护成本
